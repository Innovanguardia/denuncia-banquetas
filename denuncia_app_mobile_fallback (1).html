<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <title>¡Denuncia tus banquetas! (Móvil)</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background: #f9f9f9; margin: 0; padding: 1rem;
      display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
    .form-container, .success-container {
      width: 100%; max-width: 360px; background: #fff; border-radius: 20px; padding: 1.5rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1); transition: filter 0.3s ease; position: relative; }
    .blur { filter: blur(4px); }
    h1 { color: #F26623; text-align: center; margin: 0 0 0.5rem; font-size: 1.6rem; }
    .subtitle { text-align: center; color: #555; font-size: 0.9rem; margin: 0 0 0.25rem; }
    .tagline { text-align: center; color: #AAA; font-style: italic; font-size: 0.8rem; margin-bottom: 1.2rem; }
    label { display: block; font-weight: 700; color: #333; margin-top: 1rem; margin-bottom: 0.3rem; font-size: 0.85rem; }
    input[type="text"], select, textarea, input[type="file"] {
      width: 100%; padding: 0.7rem; border: 1px solid #DDD; border-radius: 12px; font-size: 0.95rem;
      background: #FAFAFA; box-sizing: border-box; }
    textarea { resize: vertical; }
    button {
      width: 100%; padding: 1rem; font-weight: bold; border: none; border-radius: 12px;
      cursor: pointer; font-size: 1rem; margin-top: 1rem; transition: background 0.3s ease; }
    .btn-location, .btn-submit, .btn-share { background: #000; color: #F26623; }
    .btn-location:hover, .btn-submit:hover, .btn-share:hover { background: #F26623; color: #000; }
    .progress-bar { width: 100%; height: 8px; background: #EEE; border-radius: 10px; overflow: hidden;
      margin-top: 0.5rem; display: block; }
    .progress-fill { height: 100%; width: 0; background: #F26623; transition: width 0.3s ease; }
    .check-icon { display: none; text-align: center; margin-top: 0.5rem; }
    .check-icon svg { width: 36px; height: 36px; }
    #loadingOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8);
      display: none; align-items: center; justify-content: center; z-index: 2; flex-direction: row;
      gap: 12px; color: #F26623; font-size: 1.1rem; }
    .loader {
      border: 4px solid #f3f3f3; border-top: 4px solid #F26623; border-radius: 50%;
      width: 32px; height: 32px; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .success-container { text-align: center; padding: 1.5rem; display: none; }
    .pedestrian-icon img { width: 64px; height: 64px; margin-bottom: 1rem; }
    h2 { font-size: 1.4rem; color: #F26623; margin: 0.5rem 0; font-weight: 700; }
    p { color: #333; font-size: 0.95rem; margin: 0.5rem 0 0; }
    #fallbackUbic { display: none; margin-top: 0.5rem; }
    #fallbackUbic input { margin-top: 0.5rem; }
    .btn-share { background: #075E54; color: #fff; }
    .btn-share:hover { background: #128C7E; }
  </style>
</head>
<body>

<div class="form-container" id="formContainer">
  <h1>¡Denuncia tus banquetas!</h1>
  <p class="subtitle">Reporta las banquetas obstruidas, mal diseñadas y que ponen en peligro a la gente</p>
  <p class="tagline">Una herramienta de <strong>Vanguardia MX</strong> impulsada con IA.</p>

  <label>Ubicación de la banqueta</label>
  <input type="text" id="ubicacion" readonly placeholder="Toca el botón para compartir ubicación">
  <button class="btn-location" onclick="getUbicacion()">📍 Compartir ubicación</button>
  <div id="fallbackUbic">
    <input type="text" id="ubicManual" placeholder="Escribe tu ubicación manualmente">
  </div>

  <label for="foto">Foto del lugar</label>
  <input type="file" id="foto" accept="image/*">
  <div class="progress-bar" id="barra"><div class="progress-fill" id="progreso"></div></div>
  <div class="check-icon" id="checkIcon">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="12" fill="#F26623"/><path d="M6 12l4 4 8-8" stroke="#fff" stroke-width="2" fill="none"/></svg>
  </div>

  <label for="categoria">Categoría</label>
  <select id="categoria">
    <option value="">Selecciona</option>
    <option>No hay banqueta</option>
    <option>Está cubierta de maleza</option>
    <option>Hay escombro en la banqueta</option>
    <option>Un auto interrumpe la banqueta</option>
    <option>No hay rampas</option>
    <option>Desnivel</option>
    <option>Hay un cadáver en la banqueta</option>
    <option>Está llena de indiferencia</option>
  </select>

  <label for="tiempo">¿Cuánto tiempo lleva así?</label>
  <select id="tiempo">
    <option value="">Selecciona</option>
    <option>Unos días</option>
    <option>1 a 3 meses</option>
    <option>6 meses</option>
    <option>1 año</option>
    <option>3 años</option>
    <option>5 años</option>
    <option>10 años</option>
    <option>+10 años</option>
  </select>

  <button class="btn-submit" id="enviarBtn">Enviar reporte</button>
</div>

<div class="success-container" id="successContainer">
  <div class="pedestrian-icon">
    <img src="data:image/png;base64,INSERT_BASE64_PEATON_HERE" alt="Peatón caminando">
  </div>
  <h2>Denuncia completa</h2>
  <p>Tu aporte construye una mejor comunidad.</p>
  <button class="btn-share" id="shareBtn">Invita a otros a denunciar</button>
</div>

<div id="loadingOverlay"><div class="loader"></div><div>Enviando...</div></div>

<script>
let foto64 = '';
let submitAction;

function getUbicacion() {
  if (!navigator.geolocation) {
    mostrarFallback();
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    document.getElementById('ubicacion').value =
      pos.coords.latitude + ',' + pos.coords.longitude;
  }, err => {
    mostrarFallback();
  }, { enableHighAccuracy: true, timeout: 10000 });
}

function mostrarFallback() {
  document.getElementById('fallbackUbic').style.display = 'block';
}

document.getElementById('foto').addEventListener('change', e => {
  const file=e.target.files[0]; if(!file) return;
  const reader=new FileReader(); const barra=document.getElementById('barra');
  const fill=document.getElementById('progreso'); const check=document.getElementById('checkIcon');
  fill.style.width='0%'; barra.style.display='block'; check.style.display='none';
  reader.onprogress=ev=>{ if(ev.lengthComputable) fill.style.width=(ev.loaded/ev.total*100)+'%'; };
  reader.onloadend=()=>{ fill.style.width='100%'; foto64=reader.result.split(',')[1];
    barra.style.display='none'; check.style.display='block';
  };
  reader.readAsDataURL(file);
});

document.getElementById('enviarBtn').addEventListener('click', async () => {
  const ubicField = document.getElementById('ubicacion');
  if(document.getElementById('fallbackUbic').style.display==='block') {
    const manual = document.getElementById('ubicManual').value.trim();
    if(manual) ubicField.value = manual;
  }
  const ubic=ubicField.value.trim(), cat=document.getElementById('categoria').value,
        tiempo=document.getElementById('tiempo').value;
  if(!ubic||!cat||!tiempo||!foto64){ alert('Completa todo antes de enviar.'); return; }
  document.getElementById('loadingOverlay').style.display='flex';
  document.getElementById('formContainer').classList.add('blur');
  try {
    await fetch('https://script.google.com/macros/s/AKfycbxW7TsOgac22gVHhEIHxJ9crScp3sfo7CrLB1N3ll2ZVIw4_Kt9lUSyF0NtyQZhWrS4/exec', {
      method:'POST', body:new URLSearchParams({
        ubicacion: ubic, categoria: cat, tiempo: tiempo, foto: foto64,
        'foto.name':'banqueta.jpg','foto.type':'image/jpeg'
      })
    });
    document.getElementById('loadingOverlay').style.display='none';
    document.getElementById('formContainer').style.display='none';
    document.getElementById('successContainer').style.display='block';
  } catch(err) {
    alert('Error al enviar el reporte.');
    document.getElementById('loadingOverlay').style.display='none';
    document.getElementById('formContainer').classList.remove('blur');
  }
});

document.getElementById('shareBtn').addEventListener('click', () => {
  const pageUrl = encodeURIComponent(window.location.href);
  const text = encodeURIComponent('¡Únete a denunciar banquetas en mal estado! ' + pageUrl);
  window.open('https://api.whatsapp.com/send?text=' + text, '_blank');
});
</script>
</body>
</html>
